{% extends 'msys42app/base.html' %} 

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">

{% block navbar %}
<hr class="w-100 my-1">

<nav style="display: flex; justify-content: space-between; align-items: flex-end; padding-left: 0; padding: 0; width: 100%; position: sticky;">
    <ul class="child-nav" style="display: flex; gap: 20px; list-style: none; padding: 0; margin: 0;">
        <li class="nav-item">
            <a class="nav-link" href="{% url 'view_child_profile' pk=child.id %}">
                Overview
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'view_medical_history' child.id %}">Medical History</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'annual_medical_check_list' child.id %}">Medical Checks</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{% url 'home_physicians_exam' child.id %}">
                Physician's Exam
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'view_family_medicals' child.id%}">Family Medical Records</a>
        </li>
    </ul>
    <h5> {{child.last_name}}, {{child.first_name}} {{child.middle_name}} </h5>
</nav>
{% endblock %}



{% block content %}
<div class="container-fluid" style="min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; padding: 20px;">
    <div class="card p-4 shadow-sm" style="width: 100%; max-width: 800px; margin: 0 auto; text-align: center;">
        <h2 class="text-center" style="font-weight: 1000;"> Add Annual Physician's Exam </h2>
        <h8 class="text-center mb-4"> 
            <strong> NE:</strong> Not Evaluated | 
            <strong> N:</strong> Normal |
            <strong> A:</strong> Abnormal |     
            <strong> C:</strong> Correcting   |
            <strong> R:</strong> Receiving Care</h8>
        <div class="container-fluid" style="max-width: fit-content;">

        </div>
        <form method="POST" action="{% url 'create_physicians_exam' pk=child.pk%}" class="mt-3">
            {% csrf_token %}
            <table class="table table-bordered" style="width: 80%; font-weight: 800;">
                <tr>
                    <select class="form-control" id="year" name="year" value="{{ year }}" style="background-color: black; color: white; font-weight: 700;" required>
                        <option value=""> YEAR </option>
                        {% for year in years %}
                        <option value="{{year}}"> {{ year }}</option>
                        {% endfor %}
                    </select>
                </tr>
            </table>    
            <!-- Table Layout -->
            <div class="d-flex justify-content-center" style="gap: 10px;">
                <table class="table table-bordered" style="width: 45%; font-weight: 800;">
                    <tr>
                        <td>Height</td>
                        <td>
                            <select class="form-control" id="height" name="height" value="{{ height }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Weight</td>
                        <td>
                            <select class="form-control" id="weight" name="weight" value="{{ weight }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Blood Pressure</td>
                        <td>
                            <select class="form-control" id="bp" name="bp" value="{{ bp }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Vision Right</td>
                        <td>
                            <select class="form-control" id="vision_right" name="vision_right" value="{{ vision_right }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Vision Left</td>
                        <td>
                            <select class="form-control" id="vision_left" name="vision_left" value="{{ vision_left }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Hearing Right</td>
                        <td>
                            <select class="form-control" id="hearing_right" name="hearing_right" value="{{ hearing_right }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Hearing Left</td>
                        <td>
                            <select class="form-control" id="hearing_left" name="hearing_left" value="{{ hearing_left }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Eyes</td>
                        <td>
                            <select class="form-control" id="eyes" name="eyes" value="{{ eyes }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Ears</td>
                        <td>
                            <select class="form-control" id="ears" name="ears" value="{{ ears }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>                    
                </table>
    
                <table class="table table-bordered" style="width: 45%; font-weight: 800;">
                    <tr>
                        <td>Nose</td>
                        <td>
                            <select class="form-control" id="nose" name="nose" value="{{ nose }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Throat</td>
                        <td>
                            <select class="form-control" id="throat" name="throat" value="{{ throat }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Teeth</td>
                        <td>
                            <select class="form-control" id="teeth" name="teeth" value="{{ teeth }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Heart</td>
                        <td>
                            <select class="form-control" id="heart" name="heart" value="{{ heart }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Lungs</td>
                        <td>
                            <select class="form-control" id="lungs" name="lungs" value="{{ lungs }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Abdomen</td>
                        <td>
                            <select class="form-control" id="abdomen" name="abdomen" value="{{ abdomen }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Nervous System</td>
                        <td>
                            <select class="form-control" id="nervous_system" name="nervous_system" value="{{ nervous_system }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Skin</td>
                        <td>
                            <select class="form-control" id="skin" name="skin" value="{{ skin }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Nutrition</td>
                        <td>
                            <select class="form-control" id="nutrition" name="nutrition" value="{{ nutrition }}">
                                <option value="NE">NE</option>
                                <option value="N">N</option>
                                <option value="A">A</option>
                                <option value="C">C</option>
                                <option value="R">R</option>
                            </select>
                        </td>
                    </tr>
                    <!-- Other Fields Section -->
                    <tr>
                        <td colspan="2" class="text-center" style="padding: 10px; background-color: #f8f9fa;">
                            <strong>Other Conditions</strong>
                        </td>
                    </tr>
                    <!-- Container for additional fields -->
                    <tbody id="additional-fields-container">
                    </tbody>
                    <tfoot>
                        <tr id="add-button-row">
                            <td colspan="2" style="text-align: center;">
                                <button type="button" class="btn btn-success" onclick="addRow()">&#43; Add Field</button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
    
            <button type="submit" class="btn btn-success"> Save </button>
        
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        </form>
        
    </div>
</div>
<script>
    let fieldCounter = 0;

function addRow() {
    fieldCounter++;
    const container = document.getElementById('additional-fields-container');
    const newRow = document.createElement('tr');
    newRow.id = `additional-field-${fieldCounter}`;
    
    const fieldName = fieldCounter === 1 ? 'other_label' : `additional_label_${fieldCounter}`;
    const valueName = fieldCounter === 1 ? 'other' : `additional_value_${fieldCounter}`;
    
    newRow.innerHTML = `
        <td>
            <input type="text" class="form-control" name="${fieldName}" placeholder="Condition">
        </td>
        <td>
            <div class="d-flex justify-content-between align-items-center">
                <select class="form-control" name="${valueName}">
                    <option value="NE" selected>NE</option>
                    <option value="N">N</option>
                    <option value="A">A</option>
                    <option value="C">C</option>
                    <option value="R">R</option>
                </select>
                <button type="button" class="btn btn-danger ms-2" onclick="removeRow(${fieldCounter})">&#x2715;</button>
            </div>
        </td>
    `;
    container.appendChild(newRow);

    // Hide the Add button
    document.getElementById('add-button-row').style.display = 'none';
}

function removeRow(id) {
    const row = document.getElementById(`additional-field-${id}`);
    if (row) {
        row.remove();
    }

    // Show the Add button again if no additional rows exist
    const remainingRows = document.querySelectorAll('#additional-fields-container tr');
    if (remainingRows.length === 0) {
        document.getElementById('add-button-row').style.display = '';
        fieldCounter = 0; // Reset counter if desired
    }
}

</script>

{% endblock %}
